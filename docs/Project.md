## Описание проекта

Веб-приложение для типографской обработки русскоязычных текстов с сохранением форматирования и сносок. Пользователь загружает текст в формате DOCX или HTML. Текст обрабатывается по правилам типографики и скачивается обратно в формате DOCX или HTML.

## Новая архитектура (2024)

### Общий пайплайн
1. **DOCX → HTML**
   - Используется библиотека mammoth.js для конвертации DOCX в HTML.
   - Сохраняются сноски, списки, таблицы, базовые стили.
   - DOC не поддерживается.
2. **Типографика по HTML**
   - Применяется typographText к HTML-контенту.
   - Работа только с HTML-разметкой, без потери структуры документа.
3. **HTML → DOCX** (опционально)
   - Используется html-docx-js для обратной конвертации HTML в DOCX.
   - Сохраняется структура, сноски, базовые стили (жирный, курсив, списки, таблицы, заголовки).
   - При необходимости добавляются кастомные стили (например, для неразрывных пробелов, тире и т.д.).
4. **HTML-выгрузка**
   - Для HTML-файлов — только типографика по HTML.

### API
- Универсальный обработчик для DOCX (через HTML) и HTML.
- Возврат результата в нужном формате (DOCX или HTML).

### Тестирование
- Проверка на сложных документах: сноски, таблицы, списки, спецсимволы, кириллица.

### Документация
- Обновление Project.md, USAGE-GUIDE.md, Tasktracker.md.

## Используемые технологии
- Node.js, Next.js, TypeScript
- mammoth.js (DOCX → HTML)
- typographText (типографика)
- html-docx-js (HTML → DOCX)
- Tailwind CSS (frontend)

## Требования к консистентности и поддерживаемости
- Вся обработка текста — только через HTML.
- DOC не поддерживается.
- Сохранение форматирования и сносок при конвертациях.
- Поддержка кириллицы и спецсимволов.
- Расширяемость пайплайна (добавление новых правил типографики, стилей).

## Этапы внедрения
1. Обновление архитектуры и документации.
2. Рефакторинг backend: новый обработчик DOCX/HTML через HTML.
3. Тестирование на сложных документах.
4. Обновление инструкций для пользователей.

### Цели
- Автоматизация типографской обработки русскоязычных текстов в формате .docx с сохранением форматирования и сносок.
- Минимизация ручной работы редакторов и корректоров.
- Обеспечение консистентности оформления документов.

### Архитектура
- Фронтенд: предупреждение о поддержке только DOCX
- Backend: парсинг DOCX, типографика к текстовым фрагментам, сборка DOCX
- Вся обработка реализована на Node.js, без внешних бинарников (совместимо с Vercel)

### Этапы разработки
1. Базовая обработка docx через PizZip и прямое редактирование XML.
2. Реализация типографских правил (длинное тире, диапазоны, сокращения, неразрывные пробелы и др.).
3. Сохранение форматирования и структуры документа.
4. Поддержка и обработка сносок (footnotes.xml).
5. Диагностика ошибок XML и информативные сообщения пользователю.
6. Тестирование edge-кейсов, исправление багов.
7. Доработка документации и подготовка к публикации.

### Используемые технологии
- Next.js (серверная часть)
- PizZip (работа с docx)
- Node.js Buffer
- TypeScript
- Собственный модуль типографики (lib/typography.ts)

### Стандарты и поддерживаемость
- Код покрыт комментариями, архитектура модульная.
- Все ключевые правила типографики вынесены в отдельный модуль.
- Документация ведётся в папке docs (Project.md, Tasktracker.md, Diary.md, qa.md).
- Поддерживается только формат .docx (doc, txt и др. не принимаются).
- Имя выходного файла транслитерируется, лишние символы и суффиксы удаляются.
- Все изменения и решения фиксируются в Diary.md.

### Ограничения
- Только DOCX

### Типографские правила (основные)
- Множественные пробелы заменяются на один, пробелы в начале/конце строк удаляются.
- Дефисы между словами и в начале строки заменяются на длинное тире (—) по правилам.
- Диапазоны чисел (1966-1977) заменяются на en dash (–).
- Все случаи "пробел en dash пробел" и "пробел—пробел" заменяются на неразрывный пробел—обычный пробел ( — ).
- Защита сокращений (т.-е., и т.д.), сложных слов (всё-таки, по-русски и др.).
- Не вставляется неразрывный пробел внутри сложных слов.
- Диагностика ошибок XML и информативные сообщения пользователю.

### Поддерживаемость
- Проект сопровождается через Tasktracker.md и Diary.md.
- Все архитектурные вопросы фиксируются в qa.md.
- Готов к расширению (например, для поддержки других частей docx или новых правил типографики).

## Преимущества
- Качественная типографика без потери форматирования
- Сохранение сносок и начертаний
- Простота поддержки и деплоя 