# Typography App

## Важно!

- Сервис принимает только **DOCX-файлы** (Microsoft Word Open XML Document).
- Все форматирование (жирный, курсив, подчеркивание и т.д.) и сноски сохраняются.
- На выходе вы получите обработанный DOCX-файл, пригодный для дальнейшей работы в Word и других редакторах.

## Как пользоваться

1. Загрузите DOCX-файл через форму на сайте.
2. Получите обратно DOCX-файл с типографской обработкой.

## Ограничения
- RTF, TXT и другие форматы не поддерживаются.

---

## Описание / Description

**Typography App** — это серверное приложение для автоматической типографской обработки русскоязычных документов в формате .docx. Сохраняет форматирование, структуру и сноски, обеспечивает строгие правила типографики и диагностику ошибок XML.

**Typography App** is a server-side tool for automatic Russian typography processing of .docx files. It preserves formatting, structure, and footnotes, applies strict typography rules, and provides XML error diagnostics.

---

## Основные возможности / Features
- Поддержка только .docx (Word 2007+)
- Сохранение форматирования и сносок (footnotes)
- Транслитерация имени выходного файла
- Строгие правила типографики (длинное тире, диапазоны, сокращения, неразрывные пробелы и др.)
- Диагностика и информирование об ошибках XML
- Прозрачная архитектура, легко расширяется

---

## Архитектура / Architecture
- **Next.js API Route** — серверная обработка
- **PizZip** — работа с .docx (чтение/запись XML)
- **AdvancedTypographyProcessor** — собственный модуль типографики
- **TypeScript** — строгая типизация
- **Документация** — в папке `docs/` (Project.md, Tasktracker.md, Diary.md, qa.md)

---

## Быстрый старт / Quick Start

```bash
# Клонируйте репозиторий
 git clone https://github.com/dimgo66/typography.git
 cd typography

# Установите зависимости
 npm install

# Запустите в режиме разработки
 npm run dev

# Для production-сборки
 npm run build
 npm start
```

---

## Документация / Documentation
- [Project.md](./docs/Project.md) — цели, архитектура, стандарты
- [Tasktracker.md](./docs/Tasktracker.md) — задачи и прогресс
- [Diary.md](./docs/Diary.md) — история изменений
- [qa.md](./docs/qa.md) — вопросы и архитектурные решения
- [README-USAGE.md](./README-USAGE.md) — инструкция для пользователей

---

## Технологии / Tech Stack
- Next.js 14
- TypeScript
- PizZip
- Node.js Buffer
- TailwindCSS (UI)

---

## FAQ
- **Q:** Поддерживаются ли .doc, .txt?  
  **A:** Нет, только .docx.
- **Q:** Сохраняются ли сноски?  
  **A:** Да, обрабатывается footnotes.xml.
- **Q:** Можно ли расширить правила типографики?  
  **A:** Да, модуль типографики легко расширяется.
- **Q:** Какой формат выходного файла?  
  **A:** .docx с транслитерированным именем.

---

## Реализованные правила для русского языка

- Вложенные кавычки («„“»)
- Апострофы (d’Артаньян)
- Неразрывные пробелы после частиц (а, и, но, же, ли, бы)
- Неразрывные пробелы после римских цифр (XXI век)
- Тонкие пробелы в числах (1 000 000)
- Короткое тире в диапазонах (2020–2023)
- Длинное тире в тексте (—)
- Неразрывный пробел для единиц измерения (100 кг)
- Обработка знака № (№ 123)
- Удаление лишних пробелов
- Обработка апострофов в заимствованиях (rock ’n’ roll)

---

## Ручное управление пробелами
Для особых случаев (например, между цифрой и словом) используйте ручной ввод `&nbsp;`:

Пример:  
`10&nbsp;яблок` → 10 яблок

---

## Обратная связь / Feedback
Вопросы, баги и предложения — через [issues](https://github.com/dimgo66/typography/issues) или напрямую Дмитрию Алексеевичу.

---

**© 2025 Дмитрий Горяченков** 
---

#
# Последние исправления

### ✅ Исправлена проблема с исчезновением тире в диалогах (2025-09-25)

Решена критическая проблема, при которой тире в начале абзацев (диалоги) исчезали после типографической обработки .docx файлов. 

**Проблема:** Алгоритм распределения символов неправильно обрабатывал замену en-dash (–) на em-dash (—).

**Решение:** Исправлен алгоритм сопоставления символов в `app/api/process/route.ts` для корректной обработки замен тире.

**Результат:** Все диалоги теперь корректно сохраняют тире в начале строк.